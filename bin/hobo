#!/usr/bin/env ruby 

require 'fileutils'

Signal.trap("INT") { puts; exit }

def command(s)
  system(s) or exit(1)
end

if ARGV.length == 0
  puts "USAGE: hobo <app-path> [ --user-model <model-name-or-false> ]"
  exit 1
end

app_path = ARGV.shift

user_model = ARGV.shift == "--user-model" ? ARGV.shift : "user"
user_model = nil if user_model.downcase == "false"

command("rails #{app_path}")

puts "\nInstalling Hobo plugin...\n"
FileUtils.cp_r "/users/tom/projects/hobo/vendor/plugins/hobo", "#{app_path}/vendor/plugins"
FileUtils.cp   "/users/tom/projects/hobo/vendor/plugins/hobo/routes.rb", "#{app_path}/config"

Dir.chdir(app_path) do
  command("ruby script/generate hobo")

  puts "\nInstalling Hobo Rapid and default theme...\n"
  command("ruby script/generate hobo_rapid")

  if user_model
    puts "\nCreating #{user_model} model and controller...\n"
    command("ruby script/generate hobo_user_model #{user_model}")
    command("ruby script/generate hobo_model_controller #{user_model}")
  end
  
  puts "\nCreating standard pages...\n"
  command("ruby script/generate hobo_front_controller front " +
          "#{'--no-user' unless user_model} --delete-index --add-routes")
end
